using System;
using System.Collections.Generic;
using System.Data;
using System.Linq;
using System.Web;

namespace AmbucareDAL.Repository.DAL.Query
{
    public class Q74144DAL : CommonDAL
    {
        public DataTable GetAllTeamData(string lang, string zonCode)
        {
            //return Query($"select t.*, (SELECT 'Id:' ||T7.T_USER_ID||' '||'Name:' ||T4D.T_FIRST_LANG2_NAME ||''|| T4D.T_FATHER_LANG2_NAME ||' '|| T4D.T_FAMILY_LANG2_NAME ||' ,' ||'Mobile :'|| T_MOBILE_NO FROM T74057 T7 INNER JOIN T74004 T4D ON T7.T_EMP_ID = T4D.T_EMP_ID WHERE T7.T_USER_ID=T.docID )DOCTOR_DETAILS from ( SELECT DISTINCT T57.T_USER_ID, T57.T_LOGIN_STATUS, T41.T_PAT_ID, T41.T_REQUEST_ID, nvl2(T05.T_REQUEST_ID, T41.T_CHAT_DOC_ID,null) docID,T41.T_CHAT_DOC_ID DOCOTR_ID, T46.T_FIRST_LANG2_NAME ||' ' || T46.T_FATHER_LANG2_NAME ||' ' || T46.T_GFATHER_LANG2_NAME T_PAT_NAME, T50.T_LANG2_NAME SEX, T55.T_LANG2_NAME CHEIF_COMP, T04.T_FAMILY_LANG2_NAME ||' '|| T04.T_FATHER_LANG2_NAME ||' '|| T04.T_FIRST_LANG2_NAME T_OPERETOR_NAME, CASE WHEN T05.T_REQUEST_ID IS NOT NULL THEN 'Assigned' ELSE 'N/A' END T_DOCTOR, T41.T_AGE ||'Y' AGE,T05.T_FINAL_FLAG FROM T74041 T41 LEFT JOIN T74057 T57 ON T41.T_USER_ID =T57.T_USER_ID LEFT JOIN T74046 T46 ON T41.T_PAT_ID=T46.T_PAT_ID left join T74050 T50 on T46.T_SEX_CODE = T50.T_SEX_CODE LEFT JOIN T74004 T04 ON T57.T_EMP_ID =T04.T_EMP_ID LEFT JOIN T74055 T55 ON T41.T_CH_COMP =T55.T_CH_COMP LEFT JOIN T74105 T05 ON T41.T_REQUEST_ID =T05.T_REQUEST_ID AND T05.T_CHAT_ACPT_TIME IS NOT NULL WHERE T57.T_ZONE_CODE = {zonCode} AND T57.T_ROLE_CODE = '24' AND T41.T_DISCH_STATUS IS NULL AND T41.T_DISCHARGE_TIME IS NULL   AND T41.T_START_TIME IS NOT NULL ORDER BY T_REQUEST_ID DESC) t");



            return Query($"select t.*, (SELECT 'Id:' ||T7.T_USER_ID||' '||'Name:' ||T4D.T_FIRST_LANG2_NAME ||' '|| T4D.T_FATHER_LANG2_NAME ||' '|| T4D.T_FAMILY_LANG2_NAME ||' ,' ||'Mobile :'|| T_MOBILE_NO FROM T74057 T7 INNER JOIN T74004 T4D ON T7.T_EMP_ID = T4D.T_EMP_ID WHERE T7.T_USER_ID=T.docID )DOCTOR_DETAILS from ( SELECT DISTINCT T57.T_USER_ID, T57.T_LOGIN_STATUS, T41.T_PAT_ID, T41.T_REQUEST_ID, nvl2(T05.T_REQUEST_ID, T41.T_CHAT_DOC_ID,null) docID,T41.T_CHAT_DOC_ID DOCOTR_ID, nvl(T46.T_FIRST_LANG1_NAME,T46.T_FIRST_LANG2_NAME) ||' '|| nvl(T46.T_FATHER_LANG1_NAME,T46.T_FATHER_LANG2_NAME) || ' '|| nvl(T46.T_GFATHER_LANG1_NAME,T46.T_GFATHER_LANG2_NAME) || ' '|| nvl(T46.T_FAMILY_LANG1_NAME,T46.T_FAMILY_LANG2_NAME) T_PAT_NAME, T50.T_SHORT_GNDR_NAME SEX, T55.T_LANG2_NAME CHEIF_COMP, T04.T_FAMILY_LANG2_NAME ||' '|| T04.T_FATHER_LANG2_NAME ||' '|| T04.T_FIRST_LANG2_NAME T_OPERETOR_NAME, CASE WHEN T05.T_REQUEST_ID IS NOT NULL THEN 'Assigned' ELSE 'N/A' END T_DOCTOR, T41.T_AGE ||'Y' AGE,T05.T_FINAL_FLAG,(SELECT COUNT(*) FROM T74112 T12 WHERE T12.T_REQUEST_ID=T41.T_REQUEST_ID) PATMSG FROM T74041 T41 LEFT JOIN T74057 T57 ON T41.T_USER_ID =T57.T_USER_ID LEFT JOIN T74046 T46 ON T41.T_PAT_ID=T46.T_PAT_ID left join T74050 T50 on T46.T_SEX_CODE = T50.T_SEX_CODE LEFT JOIN T74004 T04 ON T57.T_EMP_ID =T04.T_EMP_ID LEFT JOIN T74055 T55 ON T41.T_CH_COMP =T55.T_CH_COMP LEFT JOIN (SELECT J.*, (SELECT T_FINAL_FLAG  FROM T74105 WHERE T74105.T_CHAT_ID=J.MAX_ID) T_FINAL_FLAG  FROM (SELECT C.T_REQUEST_ID, MAX(C.T_CHAT_ID) MAX_ID FROM T74105 C GROUP BY C.T_REQUEST_ID) J) T05 ON T41.T_REQUEST_ID =T05.T_REQUEST_ID  WHERE T57.T_ZONE_CODE = {zonCode} AND T57.T_ROLE_CODE = '24' AND T41.T_DISCH_STATUS IS NULL AND T41.T_DISCHARGE_TIME IS NULL   AND T41.T_START_TIME IS NOT NULL ORDER BY T_REQUEST_ID DESC) t");

            // return Query($"SELECT T57.T_USER_ID,T57.T_LOGIN_STATUS,T41.T_PAT_ID,T41.T_REQUEST_ID, T46.T_FATHER_LANG2_NAME ||' '|| T46.T_GFATHER_LANG2_NAME ||' '|| T46.T_FIRST_LANG2_NAME T_PAT_NAME, T04.T_FAMILY_LANG2_NAME ||' '|| T04.T_FATHER_LANG2_NAME ||' '|| T04.T_FIRST_LANG2_NAME T_OPERETOR_NAME,  CASE   WHEN T41.T_CHAT_DOC_ID is NOT null THEN T41.T_CHAT_DOC_ID    ELSE 'DOCTOR IS NOT ASSIGNED' END T_DOCTOR FROM T74041 T41 LEFT JOIN T74057 T57 ON T41.T_USER_ID =T57.T_USER_ID LEFT JOIN T74046 T46 ON T41.T_PAT_ID=T46.T_PAT_ID LEFT JOIN T74004 T04 ON T57.T_EMP_ID=T04.T_EMP_ID WHERE T_ZONE_CODE = '{zonCode}' AND T_ROLE_CODE = '24' AND T41.T_DISCH_STATUS IS NULL ORDER BY T_REQUEST_ID DESC ");
        }
    }
}